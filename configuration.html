<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7 at 2016-04-01 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160401" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Fences Enforcer Rule &#x2013; Configuration</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Fences Enforcer Rule</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="publishDate">Last Published: 2016-04-01
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.3-beta-SNAPSHOT
                      </li>
                      
              
      
                                    
    <li class="pull-right">
        <span class="divider">|</span>
                      <a href="http://maven.apache.org/enforcer/maven-enforcer-plugin/" class="externalLink" title="Maven Enforcer">
        Maven Enforcer</a>
      </li>

  
    <li class="pull-right">
                      <a href="./" title="Github project">
        Github project</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">docs</li>
                              
      <li>
  
                          <a href="faq.html" title="FAQ">
          <span class="none"></span>
        FAQ</a>
            </li>
                
      <li>
  
                          <a href="background.html" title="Background">
          <span class="none"></span>
        Background</a>
            </li>
                
      <li>
  
                          <a href="getting_started.html" title="Getting Started">
          <span class="none"></span>
        Getting Started</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>Configuration</a>
          </li>
                
      <li>
  
                          <a href="caveats.html" title="Caveats">
          <span class="none"></span>
        Caveats</a>
            </li>
                
      <li>
  
                          <a href="policies.html" title="Policies">
          <span class="none"></span>
        Policies</a>
            </li>
                
      <li>
  
                          <a href="alternatives.html" title="Alternatives">
          <span class="none"></span>
        Alternatives</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                      </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Configuration</h1>
<p>The following table shows which tags can appear in which contexts. The first four can appear in any of the rest so are not listed in the content column explicitly.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th>Configuration </th>
      
<th>Content </th>
      
<th>Meaning </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td><tt>&lt;trusts&gt;</tt> </td>
      
<td>Name of the class or package or <tt>*</tt> for all. </td>
      
<td>Who can access the containing API element. </td>
    </tr>
    
<tr class="a">
      
<td><tt>&lt;distrusts&gt;</tt> </td>
      
<td>Ditto </td>
      
<td>Like <tt>&lt;trusts&gt;</tt> but revokes access. </td>
    </tr>
    
<tr class="b">
      
<td><tt>&lt;name&gt;</tt> </td>
      
<td>A dotted Java identifier </td>
      
<td>Specifies a Java package, class, or class member. </td>
    </tr>
    
<tr class="a">
      
<td><tt>&lt;rationale&gt;</tt> </td>
      
<td>Human readable text </td>
      
<td>An error message shown when a sibling <tt>&lt;distrusts&gt;</tt> triggers. </td>
    </tr>
    
<tr class="b">
      
<td><hr /> </td>
      
<td><hr /> </td>
      
<td><hr /> </td>
    </tr>
    
<tr class="a">
      
<td><tt>&lt;api&gt;</tt> </td>
      
<td>Many <tt>&lt;package&gt;</tt>, <tt>&lt;class&gt;</tt> </td>
      
<td>A group of sensitive API elements. </td>
    </tr>
    
<tr class="b">
      
<td><tt>&lt;package&gt;</tt> </td>
      
<td>1 <tt>&lt;name&gt;</tt>, many <tt>&lt;package&gt;</tt>, <tt>&lt;class&gt;</tt> </td>
      
<td>A java package. </td>
    </tr>
    
<tr class="a">
      
<td><tt>&lt;class&gt;</tt> </td>
      
<td>1 <tt>&lt;name&gt;</tt>, many <tt>&lt;class&gt;</tt>, <tt>&lt;method&gt;</tt>, <tt>&lt;field&gt;</tt>, <tt>&lt;constructor&gt;</tt> </td>
      
<td>A Java class. </td>
    </tr>
    
<tr class="b">
      
<td><tt>&lt;method&gt;</tt> </td>
      
<td>1 <tt>&lt;name&gt;</tt> </td>
      
<td>Specifies a method in the enclosing <tt>&lt;class&gt;</tt> </td>
    </tr>
    
<tr class="a">
      
<td><tt>&lt;field&gt;</tt> </td>
      
<td>1 <tt>&lt;name&gt;</tt> </td>
      
<td>Specifies a field in the enclosing <tt>&lt;class&gt;</tt> </td>
    </tr>
    
<tr class="b">
      
<td><tt>&lt;constructor&gt;</tt></td>
      
<td> </td>
      
<td>Specifies a constructor in the enclosing <tt>&lt;class&gt;</tt> </td>
    </tr>
    
<tr class="a">
      
<td><hr /> </td>
      
<td><hr /> </td>
      
<td><hr /> </td>
    </tr>
    
<tr class="b">
      
<td><tt>&lt;import&gt;</tt> </td>
      
<td><i>Group</i>:<i>Artifact</i>:<i>Version</i> </td>
      
<td>Load more configuration from <tt>META-INF/fences.xml</tt> in that artifact&#x2019;s JAR </td>
    </tr>
  </tbody>
</table>
<p>For example,</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;api&gt;
  &lt;package&gt;
    &lt;name&gt;com&lt;/name&gt;
    &lt;package&gt;
      &lt;name&gt;example&lt;/name&gt;
      &lt;class&gt;
      &lt;name&gt;MisusableClass&lt;/name&gt;
        &lt;!-- Distrust by default. --&gt;
        &lt;distrusts&gt;*&lt;/distrusts&gt;
        &lt;!-- White-list of approved exceptions to the rule. --&gt;
        &lt;trusts&gt;com.example.foo.TrustworthyAccessor&lt;/trusts&gt;
        &lt;rationale&gt;
          NameOfClass exposes authority that must be used in
          accordance with strict guidelines (see ...).

          Try to use com.example.SimplerSaferAlternative instead.

          If that doesn't suffice, open a ticket at http://jira/
          and security team will work with you to find a way to use
          the simpler APIs or add your code to the white-list of
          exceptions to the rule.  (http://shortlink/misusable-faq)
        &lt;/rationale&gt;
      &lt;/class&gt;
    &lt;/package&gt;
  &lt;/package&gt;
&lt;/api&gt;
</pre></div></div>
<p>specifies that <tt>org.trustworthy.Accessor</tt> can use <tt>com.example.NameOfClass</tt> but not other classes.</p>
<p>Names can be dotted, so the configuration above can be simplified to</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;class&gt;
  &lt;name&gt;com.example.NameOfClass&lt;/name&gt;
  &lt;trusts&gt;org.trustworthy.Accessor&lt;/trusts&gt;
  &lt;distrusts&gt;*&lt;/distrusts&gt;
  &lt;rationale&gt;...&lt;/rationale&gt;
&lt;/class&gt;
</pre></div></div>
<div class="section">
<h2><a name="Writing_good_rationales."></a>Writing good <tt>&lt;rationale&gt;</tt>s. <a name="writing_good_rationales"></a></h2>
<p>The error message shown when a policy is violated is composed from the <tt>&lt;rationale&gt;</tt>&#x2026;<tt>&lt;/rationale&gt;</tt> and <tt>&lt;addendum&gt;</tt>&#x2026;<tt>&lt;/addendum&gt;</tt> elements.</p>
<p>Let&#x2019;s look at a policy in two parts:</p>

<ol style="list-style-type: decimal">
  
<li>An aggregating POM maintained by the project lead which <tt>&lt;import/&gt;</tt>s</li>
  
<li>A third-party dependency that bundles an <tt>META-INF/fences.xml</tt> file.</li>
</ol>
<p>These two files can be used as templates. The <tt>&lt;!---</tt>&#x2026;<tt>--&gt;</tt> comments are non-normative.</p>
<div class="section">
<h3><a name="Project_POM"></a>Project POM</h3>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;configuration&gt;
  &lt;import&gt;com.third_party:library&lt;/import&gt;

  &lt;!--
    A high-level addendum points developers to sources of
    information within the organization possibly including

    1. FAQs or documentation that they can read *and*
    2. user groups, issue trackers, IRC channels that
       can field questions.

    Keep this short.
    Users appreciate it the first time they see it but
    boiler-plate in logs obscures important details.

  --&gt;
  &lt;addendum&gt;
    http://wiki/java-policy-FAQ | security-team@example.com
  &lt;/addendum&gt;
  &lt;!-- Use short URLs since URLs in logs are rarely clickable. --&gt;

  &lt;package&gt;
    &lt;name&gt;com.third_party&lt;/name&gt;
    &lt;class&gt;
      &lt;name&gt;Unsafe&lt;/name&gt;
      &lt;method&gt;
        &lt;name&gt;foo&lt;/name&gt;
        &lt;!-- A white-list of exceptions to the imported rules. --&gt;
        &lt;trusts&gt;com.example.aardvark.ConsistentTransaction&lt;/trusts&gt;

        &lt;!-- There may be alternatives within the organization that
             are not available to all users of the third-party library.

             An additional rationale can supplement those docs.
        --&gt;
        &lt;rationale&gt;
          Prefer com.example.SafeAlternative to ${fences.api}.
          Ping alice@example.com if that doesn't suffice.
        &lt;/rationale&gt;
        &lt;!-- Please wrap at 60 columns post-indentation since log files
             are more readable in a console when lines don't wrap. --&gt;
      &lt;/method&gt;
    &lt;/class&gt;
  &lt;/package&gt;
&lt;/configuration&gt;
</pre></div></div></div>
<div class="section">
<h3><a name="Third-party_META-INFfences.xml"></a>Third-party <tt>META-INF/fences.xml</tt></h3>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;configuration&gt;
&lt;package&gt;
  &lt;name&gt;com.third_party&lt;/name&gt;
  &lt;class&gt;
    &lt;name&gt;Unsafe&lt;/name&gt;
    &lt;trusts&gt;com.third_party.builders&lt;/trusts&gt;
    &lt;distrusts&gt;*&lt;/distrusts&gt;

    &lt;rationale&gt;
      Uses of Unsafe must be carefully reviewed by experts in XYZ.
      Please try the safe builders in com.third_party.builders
      before rolling your own.
    &lt;/rationale&gt;
    &lt;!--
      Not all members of a public user support list have signed
      NDAs with com.example, so mentioning that support lists
      are public or non-confidential can help developers decide
      what level of detail is appropriate.
    --&gt;
    &lt;rationale&gt;
      User support (non-confidential) : users@third_party.com
      Public issue tracker : third_party.com/issues
    &lt;/rationale&gt;
  &lt;/class&gt;
&lt;/package&gt;
</pre></div></div></div>
<div class="section">
<h3><a name="Property_Interpolation"></a>Property Interpolation</h3>
<p>Rationales and addenda may include maven property expressions.</p>
<p>In addition to the normal maven properties, these properties are available:</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th>Property Name </th>
      
<th>Meaning </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td>fences.api </td>
      
<td>The sensitive API. </td>
    </tr>
    
<tr class="a">
      
<td>fences.distrusted </td>
      
<td>The distrusted namespace which accessed <tt>${fences.api}</tt>. </td>
    </tr>
    
<tr class="b">
      
<td>fences.trusts </td>
      
<td>The namespaces which <tt>${fences.api}</tt> trusts. </td>
    </tr>
  </tbody>
</table>
<p>The documentation on plexus-interpolation (the module Maven uses to do property substitution) is pretty sparse, but <a class="externalLink" href="https://github.com/codehaus-plexus/plexus-interpolation/blob/master/src/test/java/org/codehaus/plexus/interpolation/StringSearchInterpolatorTest.java">the unittests</a> provide some guidance.</p></div></div>
<div class="section">
<h2><a name="Importing_configuration"></a>Importing configuration</h2>
<p>Sometimes a library author needs to use sensitive APIs, or thinks that parts of their APIs are not for casual use. They can include, in their JAR, a <tt>META-INF/fences.xml</tt> file with content like</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;configuration&gt;
   &lt;package&gt;
     ...
   &lt;/package&gt;
   &lt;import&gt;...&lt;/import&gt;
&lt;/configuration&gt;
</pre></div></div>
<p>to specify what they require to do their jobs by <b>proposing</b> that they be trusted to use certain APIs and/or that certain of their APIs be distrusted by default. The API elements and namespaces involved in trust relationships in imported configurations are not limited to those relating to classes defined in that JAR.</p>
<p>This allows different versions to request access to different sensitive APIs, and when the artifacts are stored in Maven central, the APIs they request access to are a matter of public record.</p>
<p>A project-lead can then <b>second</b> their requests by adding to the Fences configuration a line like</p>

<div class="source">
<div class="source"><pre class="prettyprint">   &lt;import&gt;group:artifact:version&lt;/import&gt;
</pre></div></div>
<p>which says, find the JAR for the dependency with ID <tt>group:artifact:version</tt>, load the <tt>META-INF/fences.xml</tt> file, parse it, and incorporate its <tt>&lt;trusts&gt;</tt> and <tt>&lt;distrusts&gt;</tt>.</p>
<p>The version may be omitted : <tt>&lt;import&gt;group:artifact&lt;/import&gt;</tt>.</p></div>
<div class="section">
<h2><a name="System_Properties"></a>System Properties</h2>
<p>The following system properties affect the fences rule. (<a class="externalLink" href="https://github.com/mikesamuel/fences-maven-enforcer-rule/blob/master/src/main/java/com/google/security/fences/RelevantSystemProperties.java">code</a>)</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th>System property name </th>
      
<th>Value </th>
      
<th>Effect </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td><tt>fences.experimental</tt> </td>
      
<td>Irrelevant </td>
      
<td>If present, then errors are converted to warnings.</td>
    </tr>
    
<tr class="a">
      
<td><tt>fences.config.show</tt> </td>
      
<td>Irrelevant </td>
      
<td>If present, then the log will include a dump of the effective policy. </td>
    </tr>
  </tbody>
</table></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2016
                        <a href="https://www.google.com/about/appsecurity/">Google ISE</a>.
            All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
